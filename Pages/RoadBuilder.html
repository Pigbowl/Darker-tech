<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>环境生成器-V1.1</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- <script src="module.js"></script> -->    
    <!-- 自定义工具类 - 已替换@apply指令 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-gradient {
                background-clip: text;
                -webkit-background-clip: text;
                color: transparent;
            }
            .bg-grid {
                background-image: 
                    linear-gradient(rgba(97, 255, 202, 0.1) 1px, transparent 1px),
                    linear-gradient(90deg, rgba(123, 97, 255, 0.1) 1px, transparent 1px);
                background-size: 20px 20px;
            }
            .glass-effect {
                backdrop-filter: blur(10px);
                background-color: rgba(10, 14, 23, 0.8);
            }
        
            .option-active {
                background-color: #165DFF;
                color: white;
                border-color: #165DFF;
            }
            .map-container {
                background-color: #62aff7ce; /* 黑色背景 */
                border: 1px solid #333;
                border-radius: 0.5rem;
                overflow: hidden;
                cursor: crosshair;
            }
        }
        /* 在CSS部分添加或修改 */
        #mouse-position-tooltip {
            position: fixed;
            background-color: rgba(30, 41, 59, 0.9);
            color: white;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            pointer-events: none;
            z-index: 1000;
            font-family: monospace;
            white-space: nowrap;
        }
    </style>
    
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            background-color: #0A0E17;
            color: #FFFFFF;
            overflow-x: hidden;
        }
        
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* 道路生成动画 */
        @keyframes drawRoad {
            from {
                stroke-dashoffset: 1000;
            }
            to {
                stroke-dashoffset: 0;
            }
        }
        
        .road-path {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: drawRoad 0.5s forwards ease-out;
        }
        .object-type-button i {
            margin-right: 4px;
        }

        .object-type-button.option-active i {
            color: white;
        }
        /* 比例尺样式 */
        .scale-bar {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .scale-line {
            height: 2px;
            background-color: #333;
        }
        
        /* 选中道路样式 */
        .road-selected .road-path {
            filter: brightness(1.3);
            stroke: #165DFF;
            stroke-width: 1;
        }
        
        /* 选中路口样式 */
        .intersection-selected {
            filter: brightness(1.2);
            outline: 2px solid #165DFF;
            outline-offset: 2px;
        }
        
        .intersection-selected rect {
            stroke: #165DFF;
            stroke-width: 3;
        }
    </style>
</head>

<body>
    <div id="navbar-container"></div>   
    <div class = "bg-grid" style="padding-left: 20px; padding-right: 20px; width: 100%; margin: 0 auto; margin-top: 80px;">
        <!-- 背景装饰 -->
        <div class="absolute inset-0 overflow-hidden">
            <div class="absolute -top-20 -right-20 w-96 h-96 bg-logoup/20 rounded-full filter blur-3xl"></div>
            <div class="absolute bottom-10 -left-20 w-64 h-64 bg-logobuttom/20 rounded-full filter blur-3xl"></div>
        </div>
        <!-- 主内容 -->
        <div class="container mx-auto px-4 py-8">
            <!-- 主内容区域 -->
            <main class="flex flex-col lg:flex-row gap-6">
                <!-- 地图画布区域 -->
                <div class="flex-1">
                    <div class="bg-white p-4 rounded-xl shadow-md mb-4">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-lg font-semibold text-gray-800">
                                <i class="fa fa-map mr-2 text-primary"></i>地图编辑区域
                            </h2>
                            <div class="text-sm text-gray-500" id="status-indicator">
                                <i class="fa fa-circle text-green-500 mr-1"></i>
                                就绪 - 请点击设定道路起点
                            </div>
                        </div>
                        
                        <!-- 地图容器 -->
                        <div class="map-container w-full aspect-[4/3] relative" id="map-container">
                            <!-- SVG 用于绘制道路 -->
                            <svg class="absolute inset-0 w-full h-full" id="map-svg"></svg>
                            
                            <!-- 道路起点和终点标记 -->
                            <div id="start-point" class="hidden absolute w-4 h-4 bg-green-500 rounded-full transform -translate-x-1/2 -translate-y-1/2"></div>
                            <div id="end-point" class="hidden absolute w-4 h-4 bg-red-500 rounded-full transform -translate-x-1/2 -translate-y-1/2"></div>
                            
                            <!-- 端点提示容器 -->
                            <div id="endpoint-hints" class="absolute inset-0 pointer-events-none"></div>
                            
                            <!-- 比例尺 -->
                            <div class="scale-bar" id="scale-bar">
                                <span id="scale-text">50px</span>
                                <div class="scale-line" id="scale-line" style="width: 50px;"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 控制按钮 -->
                    <div class="bg-white p-4 rounded-xl shadow-md flex flex-wrap gap-3">
                        <button id="clear-map" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-all duration-300 flex items-center">
                            <i class="fa fa-trash mr-2"></i>清空地图
                        </button>
                        <!-- <button id="save-canvas" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-all duration-300 flex items-center">
                            <i class="fa fa-image mr-2"></i>保存地图数据
                        </button> -->

                        <button id="reset-scale" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-all duration-300 flex items-center">
                            <i class="fa fa-gear mr-2"></i>重置比例尺
                        </button>

                        <button id="save-map-btn" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition-colors">
                            <i class="fa fa-save mr-1"></i> 保存地图项目
                        </button>
                        <button id="load-map-btn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors">
                            <i class="fa fa-load mr-1"></i> 加载项目
                        </button>
                        <input type="file" id="map-file-input" accept=".json" class="hidden">
                        <button id="save-canvas" class="px-4 py-2 bg-primary hover:bg-primary/90 text-white rounded-lg transition-all duration-300 flex items-center ml-auto">
                            <i class="fa fa-download mr-2"></i>导出地图结果
                        </button>
                    </div>
                </div>
                
                <!-- 右侧选项器 -->
                <div class="w-full lg:w-80">
                    <div class="bg-white p-4 rounded-xl shadow-md sticky top-4">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4">
                            <i class="fa fa-sliders mr-2 text-primary"></i>选项器
                        </h2>
                        
                        <!-- 主模式选择（修改器/生成器） -->
                        <div class="mb-6">
                            <h3 class="text-sm font-medium text-gray-500 mb-2">主模式</h3>
                            <div class="flex space-x-2">
                                <button id="generator-mode" class="flex-1 px-3 py-2 border rounded-lg transition-all duration-300 option-active">
                                    <i class="fa fa-plus-circle mr-1"></i>生成器
                                </button>
                                <button id="modifier-mode" class="flex-1 px-3 py-2 border border-gray-200 text-gray-700 rounded-lg transition-all duration-300 hover:border-primary/50 hover:bg-primary/5">
                                    <i class="fa fa-wrench mr-1"></i>编辑器
                                </button>
                            </div>
                        </div>
                        
                        <!-- 编辑模式选择 -->
                        <div class="mb-6" id="edit-mode-container">
                            <h3 class="text-sm font-medium text-gray-500 mb-2">编辑模式</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <button id="road-mode-button" class="py-2 px-4 bg-primary text-white rounded-lg hover:bg-primary/90 transition-all duration-300 flex items-center justify-center option-active" onclick="switchMode('road')">
                                    <i class="fa fa-road mr-2"></i>生成道路
                                </button>
                                <button id="object-mode-button" class="py-2 px-4 bg-white border border-gray-200 hover:border-primary/50 hover:bg-primary/5 text-gray-700 rounded-lg transition-all duration-300 flex items-center justify-center" onclick="switchMode('object')">
                                    <i class="fa fa-cube mr-2"></i>生成物体
                                </button>
                                <button id="intersection-mode-button" class="py-2 px-4 bg-white border border-gray-200 hover:border-primary/50 hover:bg-primary/5 text-gray-700 rounded-lg transition-all duration-300 flex items-center justify-center" onclick="switchMode('intersection')">
                                    <i class="fa fa-plus-square mr-2"></i>生成路口
                                </button>
                            </div>
                            
                            <!-- 路口类型选择器 -->
                            <div id="intersection-type-container" class="mt-4 hidden">
                                <h3 class="text-sm font-medium text-gray-500 mb-2">路口类型</h3>
                                <div class="grid grid-cols-3 gap-2">
                                    <button id="cross-intersection-button" class="py-1 px-2 text-xs bg-primary text-white rounded border border-primary" onclick="selectIntersectionType('cross')">
                                        十字路口
                                    </button>
                                    <button id="t-junction-intersection-button" class="py-1 px-2 text-xs bg-white text-gray-700 rounded border border-gray-200 hover:border-primary/50 hover:bg-primary/5" onclick="selectIntersectionType('t-junction')">
                                        丁字路口
                                    </button>
                                    <button id="straight-intersection-button" class="py-1 px-2 text-xs bg-white text-gray-700 rounded border border-gray-200 hover:border-primary/50 hover:bg-primary/5" onclick="selectIntersectionType('straight')">
                                        直行路口
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 道路信息面板 -->
                        <div id="road-info-panel" class="space-y-4">
                            <h3 class="text-sm font-medium text-gray-500">道路信息</h3>
                            
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <div class="text-gray-500 mb-1">道路数量</div>
                                    <div class="font-semibold text-gray-800" id="road-count">0</div>
                                </div>
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <div class="text-gray-500 mb-1">总长度</div>
                                    <div class="font-semibold text-gray-800" id="total-road-length">0 像素</div>
                                </div>
                            </div>
                        </div>

                        <!-- 主模式选择（修改器/生成器） -->
                        <div class="mb-6">
                            <!-- <div class="flex space-x-2"> -->
                                <button id="show-index" class="flex-1 px-3 py-2 border rounded-lg transition-all duration-300 option-active" onclick="toggleRoadID()">
                                    <i class="fa fa-plus-circle mr-1"></i>显示道路ID
                                </button>
                                
                            <!-- </div> -->
                        </div>
                        
                        <!-- 物体信息面板（初始隐藏） -->
                        <div id="object-info-panel" class="space-y-4 hidden">
                            <h3 class="text-sm font-medium text-gray-500">物体信息</h3>
                            <div class="space-y-3">
                                <p class="text-sm text-gray-600">选择物体类型：</p>
                                <div class="grid grid-cols-2 gap-2" id="object-type-selector">
                                    <button class="py-2 px-3 text-sm bg-primary text-white rounded-lg transition-all duration-300 object-type-button option-active" data-type="sign">
                                        <i class="fa fa-sign mr-1"></i>定位标牌
                                    </button>
                                    <button class="py-2 px-3 text-sm bg-white border border-gray-200 hover:border-primary/50 hover:bg-primary/5 text-gray-700 rounded-lg transition-all duration-300 object-type-button" data-type="gantry">
                                        <i class="fa fa-arrows-h mr-1"></i>龙门架
                                    </button>
                                    <button class="py-2 px-3 text-sm bg-white border border-gray-200 hover:border-primary/50 hover:bg-primary/5 text-gray-700 rounded-lg transition-all duration-300 object-type-button" data-type="bump">
                                        <i class="fa fa-road mr-1"></i>减速带
                                    </button>
                                    <button class="py-2 px-3 text-sm bg-white border border-gray-200 hover:border-primary/50 hover:bg-primary/5 text-gray-700 rounded-lg transition-all duration-300 object-type-button" data-type="tunnel">
                                        <i class="fa fa-subway mr-1"></i>隧道
                                    </button>
                                </div>
                                <div class="mt-3 p-3 bg-blue-50 border border-blue-100 rounded-lg">
                                    <p class="text-sm text-blue-700" id="object-instruction">
                                        <i class="fa fa-info-circle mr-1"></i>当前选择：定位标牌，请在地图上点击放置物体
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 参数编辑面板（初始隐藏） -->
                        <div id="parameter-panel" class="space-y-4 hidden">
                            <h3 class="text-sm font-medium text-gray-500">参数编辑</h3>
                            <p class="text-sm text-gray-400 mb-3" id="no-selection-text">请在修改器模式下点击道路进行选择</p>
                            
                            <div id="road-parameter-form" class="hidden space-y-4">
                                <div class="space-y-2">
                                    <!-- 新增：选中道路的方向选择器 -->
                                    <div class="flex justify-between items-center">
                                        <label class="text-sm text-gray-600">道路方向</label>
                                        <select id="selected-road-direction-select" class="text-sm border rounded px-2 py-1">
                                            <option value="one-way">单向</option>
                                            <option value="two-way">双向</option>
                                        </select>
                                    </div>
                                    
                                    <!-- 新增：左侧车道数量输入框 -->
                                    <!-- <div class="flex justify-between items-center left-lane-container">
                                        <label class="text-sm text-gray-600">左侧车道数量</label>
                                        <input type="number" min="0" max="10" value="0" class="text-sm border rounded px-2 py-1" id="selected-road-left-lanes-input">
                                    </div> -->
                                    
                                    <!-- 新增：右侧车道数量输入框 -->
                                    <!-- <div class="flex justify-between items-center">
                                        <label class="text-sm text-gray-600">右侧车道数量</label>
                                        <input type="number" min="1" max="10" value="1" class="text-sm border rounded px-2 py-1" id="selected-road-right-lanes-input">
                                    </div> -->
                                    
                                    <!-- 新增：选中道路的曲率控制 -->
                                    <div class="space-y-1">
                                        <div class="flex justify-between items-center">
                                            <label class="text-sm text-gray-600">道路曲率</label>
                                            <input type="number" min="-2" max="2" step="0.1" value="0" class="text-sm border rounded px-2 py-1" id="selected-road-curvature-input">
                                        </div>
                                        <input type="range" min="-1" max="1" step="0.1" value="0" class="w-full" id="selected-road-curvature-slider" oninput="document.getElementById('selected-road-curvature-input').value = this.value">
                                        <div class="flex justify-between text-xs text-gray-500">
                                            <span>向左弯曲</span>
                                            <span>直线</span>
                                            <span>向右弯曲</span>
                                        </div>
                                    </div>
                                                                    <!-- 新增：车道线设置区域 -->
                                    <div class="space-y-3 mt-4">
                                        <h4 class="text-sm font-medium text-gray-500">车道线设置</h4>
                                        <div id="lane-markers-container" class="space-y-3">
                                            <!-- 车道线设置将通过JavaScript动态生成 -->
                                        </div>
                                    </div>
                                </div>
                                <!-- <button id="apply-changes" class="w-full px-4 py-2 bg-primary hover:bg-primary/90 text-white rounded-lg transition-all duration-300 flex items-center justify-center">
                                    <i class="fa fa-check mr-2"></i>应用修改
                                </button> -->
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            

            <!-- 页脚容器 -->
            <div id="footer-container"></div>   
        </div>
    </div>

    <!-- 添加鼠标位置提示框 -->
    <div id="mouse-position-tooltip" class="fixed bg-gray-800 text-white text-xs px-2 py-1 rounded shadow-lg pointer-events-none hidden">
        位置: X: 0, Y: 0
    </div>
    <script src="libs/roadcorefunction.js"></script>
    <script src="../js/load-components.js"></script>
</body>
</html>