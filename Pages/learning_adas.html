<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>开始学习ADAS - 达客科技</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-gradient {
                background-clip: text;
                -webkit-background-clip: text;
                color: transparent;
            }
            .bg-grid {
                background-image: 
                    linear-gradient(rgba(123, 97, 255, 0.1) 1px, transparent 1px),
                    linear-gradient(90deg, rgba(123, 97, 255, 0.1) 1px, transparent 1px);
                background-size: 20px 20px;
            }
            .glass-effect {
                backdrop-filter: blur(10px);
                background-color: rgba(10, 14, 23, 0.8);
            }
        }
    </style>
    
    <style>
        :root {
            --primary-color: #7B61FF;
            --secondary-color: #4F46E5;
            --bg-primary: #0A0E17;
            --bg-secondary: #121826;
            --text-primary: #FFFFFF;
            --text-secondary: #CCCCCC;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
        }
        
        /* 霓虹边框效果 */
        .neon-border {
            box-shadow: 0 0 5px rgba(123, 97, 255, 0.5), 
                        0 0 10px rgba(123, 97, 255, 0.3),
                        inset 0 0 5px rgba(123, 97, 255, 0.5);
            border: 1px solid rgba(123, 97, 255, 0.3);
        }
        
        /* 科技感按钮效果 */
        .tech-button {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .tech-button::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(123, 97, 255, 0.2), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }
        
        /* 页面容器样式 */
        .page-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            transition: transform 0.8s ease-in-out;
        }
        
        /* 节点图样式 */
        #network-graph {
            width: 100%;
            height: 600px;
            position: relative;
            overflow: hidden;
            background-color: rgba(10, 10, 20, 0.8);
        }
        
        /* 页面切换功能样式调整 */
        .page-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            transition: display 0.3s ease;
        }
        
        /* 绝对定位的元素样式 */
        #page3 h1, #page3 p, #page3 button {
            background-color: rgba(10, 10, 20, 0.8);
            padding: 8px 16px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }
        
        .node {
            position: absolute;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid var(--primary-color);
            background-color: var(--bg-secondary);
        }
        
        .node:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--primary-color);
        }
        
        .node.knowledge {
            background-color: var(--secondary-color);
            color: white;
            font-weight: bold;
        }
        
        .node.property {
            background-color: var(--bg-secondary);
            color: var(--primary-color);
            border-color: var(--secondary-color);
        }
        
        .connector {
            position: absolute;
            background-color: var(--primary-color);
            height: 2px;
            transform-origin: left center;
            opacity: 0.7;
        }
        
        .tooltip {
            position: absolute;
            background-color: var(--bg-secondary);
            border: 1px solid var(--primary-color);
            border-radius: 8px;
            padding: 10px;
            font-size: 14px;
            display: none;
            z-index: 1000;
            max-width: 250px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .scroll-indicator {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            cursor: pointer;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0) translateX(-50%); }
            40% { transform: translateY(-20px) translateX(-50%); }
            60% { transform: translateY(-10px) translateX(-50%); }
        }
        
        /* 隐藏滚动条但保留功能 */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <div id="navbar-container" class="fixed top-0 left-0 right-0 z-50"></div>
    
    <!-- 第一页：如何开发ADAS工具 -->
    <div id="page1" class="page-container bg-grid">
        <div class="container mx-auto px-4 py-20 relative z-10">
            <div class="max-w-3xl mx-auto text-center mb-16">
                <h1 class="text-[clamp(2rem,4vw,3rem)] font-bold mb-6">
                    <span class="text-gradient bg-gradient-to-r from-white to-gray-400">开始学习</span>
                    <span class="text-gradient bg-gradient-to-r from-[#7B61FF] to-[#4F46E5]">ADAS开发</span>
                </h1>
                <p class="text-gray-300 text-lg">踏上智能驾驶技术之旅，从基础到实践，全面掌握ADAS开发技能</p>
            </div>
            
            <div class="max-w-4xl mx-auto bg-colorsec rounded-xl p-8 neon-border">
                <h2 class="text-2xl font-bold mb-6 text-[#7B61FF]">如何开发ADAS工具</h2>
                
                <div class="space-y-8">
                    <div class="flex items-start">
                        <div class="w-12 h-12 bg-[#7B61FF]/20 rounded-full flex items-center justify-center mr-6 flex-shrink-0">
                            <i class="fa fa-lightbulb-o text-2xl text-[#7B61FF]"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold mb-3">理解ADAS基础概念</h3>
                            <p class="text-gray-400">在开发ADAS工具前，首先需要掌握高级驾驶辅助系统的基本概念，包括功能分类、技术架构和行业标准。了解ACC、AEB、LKA等核心功能的工作原理，以及它们如何协同工作提供完整的驾驶辅助体验。</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start">
                        <div class="w-12 h-12 bg-[#7B61FF]/20 rounded-full flex items-center justify-center mr-6 flex-shrink-0">
                            <i class="fa fa-cogs text-2xl text-[#7B61FF]"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold mb-3">选择合适的开发工具链</h3>
                            <p class="text-gray-400">ADAS工具开发需要多种专业工具的支持。推荐学习使用MATLAB/Simulink进行算法仿真，ROS用于机器人操作系统开发，以及各类传感器标定工具。同时，掌握C++、Python等编程语言，以及CUDA等并行计算技术也是必不可少的。</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start">
                        <div class="w-12 h-12 bg-[#7B61FF]/20 rounded-full flex items-center justify-center mr-6 flex-shrink-0">
                            <i class="fa fa-database text-2xl text-[#7B61FF]"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold mb-3">建立数据采集与处理流程</h3>
                            <p class="text-gray-400">数据是ADAS开发的基础。设计高效的数据采集系统，能够同时处理多传感器数据（摄像头、毫米波雷达、激光雷达等）。学习数据标注、清洗和增强技术，构建高质量的训练数据集和测试数据集。</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start">
                        <div class="w-12 h-12 bg-[#7B61FF]/20 rounded-full flex items-center justify-center mr-6 flex-shrink-0">
                            <i class="fa fa-code-fork text-2xl text-[#7B61FF]"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold mb-3">开发模块化架构</h3>
                            <p class="text-gray-400">采用模块化设计方法，将ADAS工具分为感知、决策、控制等核心模块。使用设计模式确保模块间的低耦合高内聚，便于后续维护和升级。实现标准化的接口定义，支持不同算法和传感器的灵活替换。</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start">
                        <div class="w-12 h-12 bg-[#7B61FF]/20 rounded-full flex items-center justify-center mr-6 flex-shrink-0">
                            <i class="fa fa-vial text-2xl text-[#7B61FF]"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold mb-3">构建仿真与测试环境</h3>
                            <p class="text-gray-400">开发虚拟仿真环境，支持场景回放和参数化测试。实现自动化测试框架，覆盖功能测试、性能测试和鲁棒性测试。建立真实道路测试流程，收集实际运行数据，持续优化算法和系统性能。</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="scrollToPage2" class="scroll-indicator z-20 p-4 cursor-pointer" onclick="scrollToPage('page2')">
            <i class="fa fa-angle-down text-3xl text-[#7B61FF]"></i>
        </div>
    </div>
    
    <!-- 第二页：如何开发ADAS功能 -->
    <div id="page2" class="page-container bg-colorsec" style="display: none;">
        <div class="container mx-auto px-4 py-20 relative z-10">
            <div class="max-w-3xl mx-auto text-center mb-16">
                <h1 class="text-[clamp(2rem,4vw,3rem)] font-bold mb-6">
                    <span class="text-gradient bg-gradient-to-r from-white to-gray-400">开发</span>
                    <span class="text-gradient bg-gradient-to-r from-[#7B61FF] to-[#4F46E5]">ADAS功能</span>
                </h1>
                <p class="text-gray-300 text-lg">深入了解ADAS功能开发的关键流程</p>
            </div>
            
            <div class="max-w-4xl mx-auto bg-colorpri rounded-xl p-8 neon-border">
                <h2 class="text-2xl font-bold mb-6 text-[#7B61FF]">ADAS功能开发核心流程</h2>
                
                <div class="space-y-6">
                    <div class="bg-darkAccent rounded-lg p-6">
                        <h3 class="text-xl font-semibold mb-4">1. 功能定义与需求分析</h3>
                        <p class="text-gray-300 mb-4">明确ADAS功能的具体目标和使用场景，如自动紧急制动(AEB)、自适应巡航控制(ACC)等。进行详细的需求分析，包括功能边界和性能指标。</p>
                        <div class="flex flex-wrap gap-3">
                            <span class="bg-[#7B61FF]/20 text-[#7B61FF] px-3 py-1 rounded-full text-sm">功能目标</span>
                            <span class="bg-[#7B61FF]/20 text-[#7B61FF] px-3 py-1 rounded-full text-sm">场景定义</span>
                        </div>
                    </div>
                    
                    <div class="bg-darkAccent rounded-lg p-6">
                        <h3 class="text-xl font-semibold mb-4">2. 系统架构设计</h3>
                        <p class="text-gray-300 mb-4">设计ADAS功能的系统架构，包括传感器配置、计算平台选择和软件模块划分等。确定信号流和处理逻辑。</p>
                        <div class="flex flex-wrap gap-3">
                            <span class="bg-[#7B61FF]/20 text-[#7B61FF] px-3 py-1 rounded-full text-sm">传感器配置</span>
                            <span class="bg-[#7B61FF]/20 text-[#7B61FF] px-3 py-1 rounded-full text-sm">计算平台</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="scrollToPage3" class="scroll-indicator z-20 p-4 cursor-pointer" onclick="scrollToPage('page3')">
            <i class="fa fa-angle-down text-3xl text-[#7B61FF]"></i>
        </div>
    </div>
    
    <!-- 第三页：ADAS功能网状图 -->
    <div id="page3" class="page-container bg-grid" style="display: none;">
        <div class="absolute top-5 left-5 z-30">
            <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold mb-2">
                <span class="text-gradient bg-gradient-to-r from-white to-gray-400">ADAS</span>
                <span class="text-gradient bg-gradient-to-r from-[#7B61FF] to-[#4F46E5]">功能架构图</span>
            </h1>
            <p class="text-gray-300">探索ADAS功能的层次结构和组件关系</p>
        </div>
        
        <div class="absolute top-5 right-5 z-30">
            <button id="resetGraph" class="tech-button bg-[#7B61FF] hover:bg-[#7B61FF]/90 text-white px-4 py-2 rounded-lg transition duration-300">
                重置视图
            </button>
        </div>
        
        <!-- 网络图直接显示在整个屏幕上 -->
        <div id="network-graph" class="absolute inset-0 w-full h-full">
            <!-- 网络图将通过JavaScript动态生成 -->
        </div>
        
        <div class="absolute bottom-5 left-1/2 transform -translate-x-1/2 text-sm text-gray-400 z-30">
            <p>提示：点击节点可展开子节点，悬停查看详细信息</p>
        </div>
        
        <div id="scrollToPage1" class="scroll-indicator absolute bottom-5 right-5 z-30 p-4 cursor-pointer" onclick="scrollToPage('page1')">
            <i class="fa fa-angle-up text-3xl text-[#7B61FF]"></i>
        </div>
    </div>
    
    <!-- 通用提示框 -->
    <div id="nodeTooltip" class="tooltip">
        <h4 id="tooltipTitle" class="font-bold text-[#7B61FF] mb-2"></h4>
        <p id="tooltipContent" class="text-gray-300"></p>
    </div>
    
    <script>
        // 页面切换功能
        function scrollToPage(pageId) {
            // console.log("ScrollToPage called with pageId:", pageId);
            
            // 检查目标页面是否存在
            const targetPage = document.getElementById(pageId);
            if (!targetPage) {
                console.error("Target page not found:", pageId);
                return;
            }
            
            // console.log("Hiding all pages");
            // 隐藏所有页面
            document.querySelectorAll('.page-container').forEach(page => {
                page.style.display = 'none';
            });
            
            // console.log("Showing target page:", pageId);
            // 显示目标页面
            targetPage.style.display = 'flex';
            
            // console.log("Scrolling to top");
            // 滚动到页面顶部
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // console.log("ScrollToPage completed");
        }
        
        // 添加额外的事件监听器来确保点击事件被捕获
        document.addEventListener('DOMContentLoaded', () => {
            // 为每个scroll-indicator添加额外的事件监听器
            document.getElementById('scrollToPage2')?.addEventListener('click', () => {
                // console.log('Scroll indicator to page2 clicked via addEventListener');
                scrollToPage('page2');
            });
            
            document.getElementById('scrollToPage3')?.addEventListener('click', () => {
                // console.log('Scroll indicator to page3 clicked via addEventListener');
                scrollToPage('page3');
            });
            
            document.getElementById('scrollToPage1')?.addEventListener('click', () => {
                // console.log('Scroll indicator to page1 clicked via addEventListener');
                scrollToPage('page1');
            });
        });
        
        // 网络图数据 - 两个层次结构：知识节点和属性节点，添加节点间的多对多关联关系
        const graphData = {
            nodes: [
                {
                    id: 'adas_core', 
                    name: 'ADAS核心功能', 
                    description: '高级驾驶辅助系统的核心功能集合，包括感知、决策和控制等关键模块', 
                    type: 'knowledge',
                    properties: [
                        { id: 'adas_definition', name: 'ADAS定义', description: '高级驾驶辅助系统(Advanced Driver Assistance Systems)的简称', type: 'property' },
                        { id: 'adas_purpose', name: 'ADAS目的', description: '提高驾驶安全性、舒适性和燃油经济性', type: 'property' },
                        { id: 'adas_levels', name: 'ADAS等级', description: 'L0-L5不同级别的自动驾驶功能定义', type: 'property' }
                    ]
                },
                {
                    id: 'environment_perception', 
                    name: '环境感知', 
                    description: '通过各种传感器感知周围环境', 
                    type: 'knowledge',
                    properties: [
                        { id: 'vehicle_detection', name: '车辆检测', description: '识别道路上的其他车辆', type: 'property' },
                        { id: 'pedestrian_recognition', name: '行人识别', description: '检测和识别行人及非机动车', type: 'property' },
                        { id: 'lane_detection', name: '车道线检测', description: '识别道路车道线和边界', type: 'property' },
                        { id: 'traffic_sign_recognition', name: '交通标志识别', description: '识别道路上的交通标志和信号', type: 'property' }
                    ]
                },
                {
                    id: 'path_planning', 
                    name: '路径规划', 
                    description: '根据感知信息和导航数据，规划车辆的行驶路径', 
                    type: 'knowledge',
                    properties: [
                        { id: 'global_planning', name: '全局路径规划', description: '基于地图的长距离路径规划', type: 'property' },
                        { id: 'local_planning', name: '局部路径规划', description: '考虑周围环境的短距离路径规划', type: 'property' },
                        { id: 'trajectory_generation', name: '轨迹生成', description: '生成平滑的车辆行驶轨迹', type: 'property' }
                    ]
                },
                {
                    id: 'motion_control', 
                    name: '运动控制', 
                    description: '控制车辆的加速、减速和转向，实现规划的行驶轨迹', 
                    type: 'knowledge',
                    properties: [
                        { id: 'speed_control', name: '速度控制', description: '控制车辆的加速和减速', type: 'property' },
                        { id: 'steering_control', name: '转向控制', description: '控制车辆的方向盘转向角度', type: 'property' },
                        { id: 'brake_control', name: '制动控制', description: '控制车辆的制动系统', type: 'property' }
                    ]
                },
                {
                    id: 'sensor_fusion', 
                    name: '传感器融合', 
                    description: '整合多传感器数据，提高环境感知的准确性和可靠性', 
                    type: 'knowledge',
                    properties: [
                        { id: 'camera_radar_fusion', name: '摄像头雷达融合', description: '融合摄像头和雷达数据', type: 'property' },
                        { id: 'lidar_camera_fusion', name: '激光雷达摄像头融合', description: '融合激光雷达和摄像头数据', type: 'property' },
                        { id: 'data_association', name: '数据关联', description: '将不同传感器数据关联到同一目标', type: 'property' }
                    ]
                },
                {
                    id: 'adas_definition', 
                    name: 'ADAS定义', 
                    description: '高级驾驶辅助系统(Advanced Driver Assistance Systems)的简称', 
                    type: 'knowledge',
                    properties: []
                },
                {
                    id: 'adas_purpose', 
                    name: 'ADAS目的', 
                    description: '提高驾驶安全性、舒适性和燃油经济性', 
                    type: 'knowledge',
                    properties: []
                },
                {
                    id: 'adas_levels', 
                    name: 'ADAS等级', 
                    description: 'L0-L5不同级别的自动驾驶功能定义', 
                    type: 'knowledge',
                    properties: []
                }
            ],
            // 节点间的关联关系，source是上游节点，target是下游节点
            connections: [
                // adas_core的下游关系
                { source: 'adas_core', target: 'adas_definition' },
                { source: 'adas_core', target: 'adas_purpose' },
                { source: 'adas_core', target: 'environment_perception' },
                { source: 'adas_core', target: 'path_planning' },
                { source: 'adas_core', target: 'motion_control' },
                { source: 'adas_core', target: 'sensor_fusion' },
                
                // adas_levels的关系
                { source: 'environment_perception', target: 'adas_levels' },
                { source: 'adas_levels', target: 'vehicle_detection' },
                
                // 其他关联关系
                { source: 'environment_perception', target: 'path_planning' },
                { source: 'path_planning', target: 'motion_control' },
                { source: 'sensor_fusion', target: 'environment_perception' },
                { source: 'sensor_fusion', target: 'vehicle_detection' },
                { source: 'environment_perception', target: 'pedestrian_recognition' },
                { source: 'environment_perception', target: 'lane_detection' },
                { source: 'environment_perception', target: 'traffic_sign_recognition' }
            ]
        };
        
        // 网络图绘制功能
        let currentGraph = null;
        let expandedNode = null; // 当前展开的节点
        let nodePositions = {}; // 存储节点位置信息
        
        function drawNetwork() {
            const graphContainer = document.getElementById('network-graph');
            const width = graphContainer.clientWidth;
            const height = graphContainer.clientHeight;
            
            // 清空容器和位置记录
            graphContainer.innerHTML = '';
            nodePositions = {};
            
            // 计算中心位置
            const centerX = width / 2;
            const centerY = height / 2;
            
            // 确保graphData.nodes是数组且不为空
            if (!Array.isArray(graphData.nodes) || graphData.nodes.length === 0) {
                console.warn('No nodes found in graphData');
                return;
            }
            
            // 创建连接线容器，确保连接线在节点下方
            const connectionsContainer = document.createElement('div');
            connectionsContainer.className = 'connections-container';
            connectionsContainer.style.position = 'absolute';
            connectionsContainer.style.top = '0';
            connectionsContainer.style.left = '0';
            connectionsContainer.style.width = '100%';
            connectionsContainer.style.height = '100%';
            connectionsContainer.style.pointerEvents = 'none';
            graphContainer.appendChild(connectionsContainer);
            
            // 计算知识节点的位置（圆形排列）
            // 根据屏幕尺寸调整半径，留出足够的边缘空间
            const radius = Math.min(width, height) * 0.35;
            const knowledgeNodes = graphData.nodes.filter(node => node.type === 'knowledge');
            
            knowledgeNodes.forEach((node, index) => {
                const angle = (index / knowledgeNodes.length) * 2 * Math.PI;
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);
                
                // 节点大小根据屏幕尺寸动态调整
                const baseSize = Math.min(width, height) * 0.04;
                let nodeSize = baseSize;
                if (node.id === 'adas_core') nodeSize = baseSize * 1.5; // 核心节点更大
                
                // 确保节点大小不小于最小尺寸
                nodeSize = Math.max(nodeSize, 50);
                
                // 记录节点位置
                nodePositions[node.id] = { x, y, size: nodeSize };
                
                // 创建节点
                createNode(node, x, y, nodeSize);
                
                // 如果是当前展开的节点，绘制其属性节点
                if (expandedNode && expandedNode.id === node.id && node.properties) {
                    drawPropertyNodes(node, x, y, nodeSize);
                }
            });
            
            // 绘制知识节点之间的关联关系
            drawKnowledgeConnections(connectionsContainer);
            
            // 保存当前图形状态
            currentGraph = { centerX, centerY };
        }
        
        // 绘制知识节点之间的关联关系
        function drawKnowledgeConnections(container) {
            if (!Array.isArray(graphData.connections) || graphData.connections.length === 0) {
                return;
            }
            
            graphData.connections.forEach(connection => {
                const sourcePos = nodePositions[connection.source];
                const targetPos = nodePositions[connection.target];
                
                // 只有当两个节点都存在且都在节点位置记录中时，才绘制连接线
                if (sourcePos && targetPos) {
                    // 计算连接线的起点和终点（从节点边缘开始，而不是中心点）
                    const sourceX = sourcePos.x;
                    const sourceY = sourcePos.y;
                    const targetX = targetPos.x;
                    const targetY = targetPos.y;
                    
                    // 创建连接线
                    const connector = createConnectorElement(
                        sourceX, 
                        sourceY, 
                        targetX, 
                        targetY,
                        'rgba(79, 70, 229, 0.6)' // 连接线颜色，使用蓝色调
                    );
                    container.appendChild(connector);
                }
            });
        }
        
        // 创建连接线元素
        function createConnectorElement(x1, y1, x2, y2, color) {
            const connector = document.createElement('div');
            
            // 计算连接线的长度和角度
            const dx = x2 - x1;
            const dy = y2 - y1;
            const length = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;
            
            // 设置连接线样式
            connector.style.position = 'absolute';
            connector.style.width = `${length}px`;
            connector.style.height = '2px';
            connector.style.backgroundColor = color;
            connector.style.left = `${x1}px`;
            connector.style.top = `${y1}px`;
            connector.style.transformOrigin = '0 0';
            connector.style.transform = `rotate(${angle}deg)`;
            connector.style.zIndex = '10'; // 确保在节点下方
            
            // 添加连接线动画效果
            connector.style.transition = 'opacity 0.3s ease-in-out';
            connector.style.opacity = '0';
            setTimeout(() => {
                connector.style.opacity = '1';
            }, 100);
            
            return connector;
        }
        
        // 绘制属性节点
        function drawPropertyNodes(parentNode, parentX, parentY, parentSize) {
            const properties = parentNode.properties || [];
            // 根据父节点大小计算属性节点大小，保持比例关系
            const propNodeSize = parentSize * 0.6; // 属性节点大小为父节点的60%
            const gap = propNodeSize * 0.4; // 间隔为属性节点大小的40%
            
            // 属性节点绘制在父节点右侧，垂直排列
            const startY = parentY - (properties.length * (propNodeSize + gap) - gap) / 2;
            
            properties.forEach((propNode, index) => {
                const x = parentX + parentSize / 2 + propNodeSize / 2 + 50; // 右侧50px距离
                const y = startY + index * (propNodeSize + gap);
                
                // 记录属性节点位置
                nodePositions[propNode.id] = { x, y, size: propNodeSize };
                
                // 创建属性节点
                createNode(propNode, x, y, propNodeSize);
                
                // 创建连接线
                const connector = createConnectorElement(
                    parentX + parentSize / 2,
                    parentY,
                    x - propNodeSize / 2,
                    y,
                    'rgba(37, 99, 235, 0.8)' // 属性连接线颜色
                );
                
                // 获取连接线容器并添加连接线
                const connectionsContainer = document.querySelector('.connections-container');
                if (connectionsContainer) {
                    connectionsContainer.appendChild(connector);
                }
            });
        }
        
        function createNode(data, x, y, size) {
            const graphContainer = document.getElementById('network-graph');
            const node = document.createElement('div');
            
            // 根据节点类型设置不同的样式
            if (data.type === 'knowledge') {
                // 所有知识节点都使用相同的样式，无论是否为顶层节点
                node.className = 'node knowledge bg-indigo-900/50 border border-cyan-400 rounded-lg flex items-center justify-center cursor-pointer transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-cyan-500/20';
            } else if (data.type === 'property') {
                node.className = 'node property bg-blue-800/40 border border-blue-400 rounded-md flex items-center justify-center cursor-default transition-all duration-300 hover:scale-105';
            }
            
            node.id = data.id;
            node.style.width = `${size}px`;
            node.style.height = `${size}px`;
            node.style.left = `${x - size/2}px`;
            node.style.top = `${y - size/2}px`;
            node.style.position = 'absolute'; // 确保节点正确定位
            node.style.zIndex = '20'; // 确保节点在连接线上方
            
            // 根据节点大小调整字体大小
            const fontSize = Math.max(10, size / 8);
            node.style.fontSize = `${fontSize}px`;
            
            // 截断显示名称
            const displayName = data.name.length > 10 ? data.name.substring(0, 10) + '...' : data.name;
            node.innerHTML = displayName;
            
            // 添加悬停事件
            node.addEventListener('mouseenter', (e) => {
                const tooltip = document.getElementById('nodeTooltip');
                document.getElementById('tooltipTitle').textContent = data.name;
                document.getElementById('tooltipContent').textContent = data.description;
                
                tooltip.style.display = 'block';
                tooltip.style.left = `${e.pageX + 10}px`;
                tooltip.style.top = `${e.pageY - 10}px`;
            });
            
            node.addEventListener('mousemove', (e) => {
                const tooltip = document.getElementById('nodeTooltip');
                tooltip.style.left = `${e.pageX + 10}px`;
                tooltip.style.top = `${e.pageY - 10}px`;
            });
            
            node.addEventListener('mouseleave', () => {
                document.getElementById('nodeTooltip').style.display = 'none';
            });
            
            // 为知识节点添加点击事件，用于展开/收起属性节点
            if (data.type === 'knowledge' && data.properties && data.properties.length > 0) {
                node.addEventListener('click', () => {
                    expandNode(data);
                });
            }
            
            graphContainer.appendChild(node);
        }
        
        // 展开或收起节点的属性
        function expandNode(nodeData) {
            // 如果点击的是当前展开的节点，则收起；否则展开新节点
            if (expandedNode && expandedNode.id === nodeData.id) {
                expandedNode = null;
            } else {
                expandedNode = nodeData;
            }
            
            // 重新绘制网络图
            drawNetwork();
        }
        
        
        function createConnector(x1, y1, x2, y2) {
            const graphContainer = document.getElementById('network-graph');
            const connector = document.createElement('div');
            
            // 计算连接线的长度和角度
            const dx = x2 - x1;
            const dy = y2 - y1;
            const length = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;
            
            connector.className = 'connector';
            connector.style.width = `${length}px`;
            connector.style.left = `${x1}px`;
            connector.style.top = `${y1}px`;
            connector.style.transform = `rotate(${angle}deg)`;
            
            graphContainer.appendChild(connector);
        }
        

        
        // 监听窗口大小变化，重新绘制图形
        window.addEventListener('resize', drawNetwork);
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 加载导航栏
            fetch('../components/navbar.html')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('navbar-container').innerHTML = html;
                });
            
            // 初始化网络图
            drawNetwork();
            
            // 添加重置按钮事件监听
            const resetGraphBtn = document.getElementById('resetGraph');
            if (resetGraphBtn) {
                resetGraphBtn.addEventListener('click', () => {
                    expandedNode = null; // 清除展开状态
                    drawNetwork(); // 重新绘制图形
                });
            }
            
            // 窗口大小变化时重新绘制图形
            window.addEventListener('resize', drawNetwork);
        });
        
        // 定义CSS变量
        document.documentElement.style.setProperty('--logoup', '#7B61FF');
        document.documentElement.style.setProperty('--logobuttom', '#4F46E5');
        document.documentElement.style.setProperty('--bg-primary', '#0A0E17');
        document.documentElement.style.setProperty('--bg-secondary', '#121826');
        document.documentElement.style.setProperty('--bg-tertiary', '#1E2538');
        document.documentElement.style.setProperty('--colorpri', '#0A0E17');
        document.documentElement.style.setProperty('--colorsec', '#121826');
        document.documentElement.style.setProperty('--darkAccent', '#1E2538');
    </script>
</body>
</html>